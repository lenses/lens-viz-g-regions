<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../thelma-core/thelma_core.html">
<link rel="import" href="../thelma-charts/th-d3-chart.html">
<link rel="import" href="../thelma-utils/th-theme.html">
<link rel="import" href="../google-chart/google-chart.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <th-google-regions></th-google-regions>

@element th-google-regions
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://nishacodes.github.io/th-google-regions
-->
<polymer-element extends="d3-chart" name="th-google-regions" attributes="region resolution dataLabel color backgroundColor minValue maxValue displayMode">
  <core-style ref="theme"></core-style>

  <template> 
    <google-chart
          type='geo'
          height="{{chartHeight}}px"
          width="{{chartWidth}}px"
          options= "{{options}}"
          data="{{data}}">
    </google-chart>
  </template>

  <script>

    Polymer('th-google-regions', {
      region: "155", // world, continent code, subcontinent code, country code, state code
      resolution: "countries", // countries, provinces, metros
      dataLabel: "Popularity",
      chartData: [
        {"region": "Germany", "value": 100},
        {"region": "Switzerland", "value": 50},
        {"region": "France", "value": 300},
        {"region": "Austria", "value": 200},
        {"region": "Netherlands", "value": 500}
      ],
      minValue: "0",
      maxValue: "",
      chartWidth: 280,
      chartHeight: 400,
      backgroundColor: "",
      color: "",
      displayMode: "auto", 
      numberFormat: "",
      showTooltips: true,      
      ready: function() {
        var self = this;
        self.reformatData();
        self.configureOptions();

      },
      reformatData: function(){
        var self = this;        
        self.data = self.chartData.map(function(item){
          return [item.region, item.value];
        });
        self.data.unshift(["Metro", self.dataLabel]);
      },
      configureOptions: function(){
        var self = this,
            colors =  self.getColors();
        
        // Determine intermediate variables
        self.color = self.color || colors.accents[0];
        self.backgroundColor = self.backgroundColor || "none";
        self.minValue = self.minValue || 0;

        // Define chart options 
        self.options = {
          tooltip: { trigger: 'selection'},
          displayMode: self.displayMode,
          colorAxis: { colors: [self.color] },
          backgroundColor: {fill: self.backgroundColor},
          region: self.region,
          resolution: self.resolution,
        
          legend: { 
            numberFormat: self.numberFormat,
            textStyle: { 
              color: colors.theme.foreground1, 
              fontName: colors.theme.font, 
              fontSize: '0.85em'
            } 
          }
        };

        if (self.minValue) { self.options.colorAxis.minValue = self.minValue; }
        if (self.maxValue) { self.options.colorAxis.maxValue = self.maxValue; }

      },
      getColors: function(){
        colors = {};
        colors.theme = window.CoreStyle.g.theme;
        colors.accents = [];

        for (var color in colors.theme){
          if(/^accent/.test(color)){
            colors.accents.push(colors.theme[color]);
          }
        }

        colors.count = colors.accents.length;

        return colors;
      }

    });

  </script>

</polymer-element>
